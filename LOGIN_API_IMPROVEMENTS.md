# ç”¨æˆ¶ç™»éŒ„APIæ”¹é€²

## æ¦‚è¿°
æ”¹é€²ç”¨æˆ¶ç™»éŒ„åŠŸèƒ½ï¼Œæä¾›æ›´ç²¾ç¢ºçš„éŒ¯èª¤è¨Šæ¯å’Œæ›´è©³ç´°çš„æˆåŠŸå›æ‡‰ã€‚

## APIç«¯é»
```
POST /users/login
```

## è«‹æ±‚æ ¼å¼
```json
{
    "email": "user@example.com",
    "password": "userpassword"
}
```

## å›æ‡‰æ ¼å¼

### 1. ç™»éŒ„æˆåŠŸ (200)
```json
{
    "message": "ç™»å…¥æˆåŠŸ",
    "user": {
        "id": "123",
        "email": "user@example.com",
        "nickname": "ç”¨æˆ¶æš±ç¨±",
        "avatar_url": "https://example.com/avatar.jpg",
        "gender": "ç”·",
        "age": 25,
        "location": "å°åŒ—å¸‚"
    },
    "login_time": "2025-08-11T14:30:00.123456"
}
```

### 2. ä¿¡ç®±æœªè¨»å†Š (404)
```json
{
    "detail": "æ­¤ä¿¡ç®±å°šæœªè¨»å†Š"
}
```

### 3. å¯†ç¢¼éŒ¯èª¤ (401)
```json
{
    "detail": "å¯†ç¢¼éŒ¯èª¤"
}
```

### 4. ç³»çµ±éŒ¯èª¤ (500)
```json
{
    "detail": "ç³»çµ±éŒ¯èª¤"
}
```

## åŠŸèƒ½ç‰¹é»

### ğŸ” ç²¾ç¢ºçš„éŒ¯èª¤è­˜åˆ¥
- **404éŒ¯èª¤**: æ˜ç¢ºå‘ŠçŸ¥ä¿¡ç®±æœªè¨»å†Šï¼Œå¼•å°ç”¨æˆ¶å»è¨»å†Š
- **401éŒ¯èª¤**: æ˜ç¢ºå‘ŠçŸ¥å¯†ç¢¼éŒ¯èª¤ï¼Œç”¨æˆ¶å¯ä»¥é‡æ–°è¼¸å…¥å¯†ç¢¼
- **500éŒ¯èª¤**: ç³»çµ±å±¤ç´šéŒ¯èª¤

### ğŸ“Š è©³ç´°çš„æˆåŠŸå›æ‡‰
- åŸºæœ¬ç”¨æˆ¶ä¿¡æ¯ï¼ˆIDã€ä¿¡ç®±ï¼‰
- å€‹äººè³‡æ–™ï¼ˆæš±ç¨±ã€é ­åƒã€æ€§åˆ¥ã€å¹´é½¡ã€ä½ç½®ï¼‰
- ç™»éŒ„æ™‚é–“æˆ³è¨˜

### ğŸ” å®‰å…¨è€ƒé‡
- å¯†ç¢¼é©—è­‰ï¼ˆç›®å‰ä½¿ç”¨æ˜æ–‡æ¯”è¼ƒï¼Œç”Ÿç”¢ç’°å¢ƒæ‡‰ä½¿ç”¨åŠ å¯†ï¼‰
- ç™»éŒ„ç‹€æ…‹æ›´æ–°ï¼ˆè¨­ç½®ç‚ºåœ¨ç·šç‹€æ…‹ï¼‰
- è©³ç´°çš„æ—¥èªŒè¨˜éŒ„

### ğŸ“ æ—¥èªŒè¨˜éŒ„
- ç™»éŒ„å˜—è©¦è¨˜éŒ„
- æˆåŠŸç™»éŒ„è¨˜éŒ„
- å¤±æ•—åŸå› è¨˜éŒ„ï¼ˆä¿¡ç®±ä¸å­˜åœ¨ vs å¯†ç¢¼éŒ¯èª¤ï¼‰

## æ¸¬è©¦

ä½¿ç”¨æ¸¬è©¦è…³æœ¬é©—è­‰ä¸åŒç™»éŒ„æƒ…æ³ï¼š
```bash
python test_login_scenarios.py
```

æ¸¬è©¦åŒ…å«ï¼š
1. æœªè¨»å†Šä¿¡ç®±ç™»éŒ„
2. å·²è¨»å†Šä¿¡ç®±ä½†å¯†ç¢¼éŒ¯èª¤
3. æ­£ç¢ºä¿¡ç®±å’Œå¯†ç¢¼ç™»éŒ„

## å‰ç«¯é›†æˆå»ºè­°

### JavaScript ç¤ºä¾‹
```javascript
async function loginUser(email, password) {
    try {
        const response = await fetch('/users/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email, password })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            // ç™»éŒ„æˆåŠŸ
            console.log('ç™»éŒ„æˆåŠŸ:', data.user);
            localStorage.setItem('user', JSON.stringify(data.user));
            return { success: true, user: data.user };
        } else {
            // ç™»éŒ„å¤±æ•—
            if (response.status === 404) {
                return { success: false, error: 'æ­¤ä¿¡ç®±å°šæœªè¨»å†Š', needRegister: true };
            } else if (response.status === 401) {
                return { success: false, error: 'å¯†ç¢¼éŒ¯èª¤', needPassword: true };
            } else {
                return { success: false, error: data.detail || 'ç™»éŒ„å¤±æ•—' };
            }
        }
    } catch (error) {
        return { success: false, error: 'ç¶²è·¯éŒ¯èª¤' };
    }
}
```

## æ”¹é€²æ­·å²
- åŸæœ¬çµ±ä¸€å›å‚³ã€Œå¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤ã€
- ç¾åœ¨ç²¾ç¢ºå€åˆ†ä¿¡ç®±ä¸å­˜åœ¨å’Œå¯†ç¢¼éŒ¯èª¤
- å¢åŠ è©³ç´°çš„ç”¨æˆ¶ä¿¡æ¯å›æ‡‰
- æ·»åŠ ç™»éŒ„æ™‚é–“æˆ³è¨˜
